== Welcome to the Fathom Project

Fathom is a social networking and "showcasing" application for scholars, projects, and organizations in an academic setting. Represent your work. Visualize and explore relationships. Find research partners. Create community.

Fathom is built in Ruby on Rails and integrates with Wordpress for easy content management and with Relation Browser to visualize connections among people, projects, and organizations. Fathom is being designed for use by the digital humanities community at the University of Virginia, where it will be released in Summer 2008 as UVA's "Digital Humanities Portal."

Fathom is a project of the University of Virginia Library's Scholars' Lab, working in collaboration with Performant Software Solutions (www.performantsoftware.com). For more information, please see our Rubyforge site or contact bethany@virginia.edu.

== Installing Fathom

To install a fathom on your server or local machine, you must install the software and gems listed below, except for Wordpress, which you will install later in the process. For more detailed instructions on installing required software or Ruby Gems please visit their respective websites. 

Software Requirements
=====================

   * Apache 2 w/ mod_rewrite and mod_php
   * Wordpress 2.5.1
   * PHP5
   * MySQL 4+
   * FreeImage (http://sourceforge.net/projects/freeimage)
   * RubyInline (http://rubyforge.org/projects/rubyinline)


Required Gems
=============

   * rails 2.0.2
   * mysql 2.7
   * json_pure 1.1.2
   * mongrel 1.1.5
   * ruby-openid 2.0.4
   * image_science 1.1.3
   * mislav-will_paginate 2.3.2 (gem install mislav-will_paginate --source http://gems.github.com/)


Once these are installed, copy the config/database.example.yml file to config/database.yml. Then edit the config/database.yml file to point to your local development, test, and production databases. Create these databases and then run the database migrations. Next, edit the config/environments/production.rb file to point to mail server you wish to use for Fathom to send e-mails to users. Run rake to verify that all unit and functional tests pass. Start up mongrel and fathom is running, minus Wordpress.  

Wordpress Integration
======================

In order to integrate Wordpress, you must first set up an Apache mod_rewrite rule which will route requests to either Apache for Wordpress URLs or Mongrel for Fathom URLs. First, install a clean version of Wordpress 2.5.1 into a subdirectory named wordpress in the Rails public folder. Follow the normal procedure for installing Wordpress. You may use the same database name as the database for the production fathom site or a difference name. Once Wordpress is working, then you need to apply the Apache rewrite rules. Wordpress must be installed successfully before you change the apache config or it won't work. Here's a sample virtual host entry which does the trick, obviously modify the server name and paths: 

<VirtualHost *:80>
    ServerName fathom.performantsoftware.com
    DocumentRoot /usr/local/www/fathom/public

   <Directory "/usr/local/www/fathom/public">
      Options FollowSymLinks
      AllowOverride None 
      Order allow,deny
      Allow from all
   </Directory>

RewriteEngine On

RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d

RewriteRule ^/wordpress$ /wp/index.php [QSA]
RewriteRule ^(/wordpress.*/$)$ $1/index.php [QSA]
RewriteRule ^/wordpress/?(.*)$ %{DOCUMENT_ROOT}/wp/$1 [NC,QSA,L]

   # Redirect all non-static requests to mongrel
  RewriteCond %{DOCUMENT_ROOT}/%{REQUEST_FILENAME} !-f
  RewriteRule ^/(.*)$ http://localhost:3001%{REQUEST_URI} [P,QSA,L]

   ErrorLog /usr/local/www/fathom/log/apache_error.log
   CustomLog /usr/local/www/fathom/log/apache_access.log combined
</VirtualHost>

Once this rule is in place, go back to the public folder and move the wordpress folder to wp:

mv wordpress wp

Now the rewrite rule will cause all links to /wordpress to go to /wp and also to be processed by Apache instead of Mongrel, thus running PHP. The rest of the site is hosted by the mongrel you pointed at on this line:

RewriteRule ^/(.*)$ http://localhost:3001%{REQUEST_URI} [P,QSA,L]

== Wordpress Initial Data

The style for the Digitial Humanities Portal at UVA is provided as a starting point. To use it, you need to incorporate the Cat4 theme into Wordpress. To do this run the following rake task:

rake fathom:install_theme

Now, if you log into the Wordpress admin control panel, you can select "Design" and then select to install the "Category 4" theme. Next, go to "Plugins" (in the group of three options on the right hand side of the page) and activate the "WP-PageNavi" plugin. Finally, go to Manage->Import->Wordpress and select the file RAILS_ROOT/wordpress/wordpress.dhp.xml to import.

Add a Super User
==================

The site should be all set! You can signup and create your Fathom account. Once you have done this, the last step is to give your account "Root" access level by running the following SQL in the production database:

UPDATE users SET access_level="Root" WHERE id= <your account's ID>;
